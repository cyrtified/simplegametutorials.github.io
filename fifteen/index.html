<html><head><title>Fifteen Tutorial</title>
<link href="https://fonts.googleapis.com/css?family=Quicksand:500,700" rel="stylesheet">
<style>
body {
    font-family: Calibri, sans-serif;
    margin: 20px;
    background: #efefef;
}
p, li, td, h1, h2, h3, h4 {
    font-family: 'Quicksand';
    color: #333;
}
p, li, td, pre {
    font-weight: 500;
    font-size: 11pt;
}
a {
    color: #059dc5;
    text-decoration: none;
}
a:hover {
    text-decoration: underline;
}
p {
    max-width: 600px;
    line-height: 1.4;
}
td {
    padding-right:10px
}
pre {
    margin-top: 0;
    min-width: 600px;
}
.pre {
    display: table;
    margin: 20px 0;
}
img {
    display: block;
    margin: 14px 0;
}
.code {
    font-family: Consolas, Monaco, Inconsolata, monospace;
    border-radius: 8px;
    background: #fff;
    color: #555;
    padding: 12px;
}
.inlinecode {
    font-family: Consolas, Monaco, Inconsolata, monospace;
    color: #555;
}
.console {
    font-family: Consolas, Monaco, Inconsolata, monospace;
    padding: 16px;
    background: #555;
    border-radius: 8px;
    color: #eee;
}
.name {color:#e824b7;}
.call {color:#ab22d0;}
.literal {color:#01afa5; color:#ea9b4c;}
.comment {color:#555; background:#eee; border-radius: 4px;}
.highlight {background:#fcffc4; border-radius: 4px;}
.highlight .comment, .comment .highlight {background:#f0edd3;}
</style>
</head>
<body>
<h3><a href="../">Introduction and other tutorials</a></h3>
<h1>Fifteen</h1>
<h2><a href="fifteen.love">Download fifteen.love</a></h2>
<img src="1.png">
<h2>Rules</h2>
<p>There is a board with 15 pieces and an empty space. Move the pieces around until they are in sequential order by using the arrow keys to move pieces into the empty space.</p>
<h2>Controls</h2>
<table>
<tr><td><b>Arrow keys</b></td><td>Move piece</td></tr>
</table>
<h2>Overview</h2>
<p>The pieces are stored as a grid of numbers.</p>
<p>The number 16 represents the empty space.</p>
<img src="2.png">
<p>The other numbers are swapped with the empty space when an arrow key is pressed.</p>
<p>At the start of the game, the grid is initially in sorted order, and random moves are made to shuffle it. If the grid were set to random numbers instead, it could result in an unsolvable board.</p>
<p>After a piece has been moved, the pieces are looped through, and if they all have their initial sorted values, then the game is over.</p>
<h2>Coding</h2>
<h3>Drawing pieces</h3>
<p>The pieces are drawn as squares.</p>
<p>For now, a piece is drawn where the empty space should be.</p>
<div class="pre"><pre class="code">
function <span class="name">love.draw</span>()
    for <span class="name">y</span> = <span class="literal">1</span>, <span class="literal">4</span> do
        for <span class="name">x</span> = <span class="literal">1</span>, <span class="literal">4</span> do
            local <span class="name">pieceSize</span> = <span class="literal">100</span>
            local <span class="name">pieceDrawSize</span> = <span class="name">pieceSize</span> - <span class="literal">1</span>
            <span class="call">love.graphics.setColor</span>(<span class="literal">.4</span>, <span class="literal">.1</span>, <span class="literal">.6</span>)
            <span class="call">love.graphics.rectangle</span>(
                <span class="literal">'fill'</span>,
                (<span class="name">x</span> - <span class="literal">1</span>) * <span class="name">pieceSize</span>,
                (<span class="name">y</span> - <span class="literal">1</span>) * <span class="name">pieceSize</span>,
                <span class="name">pieceDrawSize</span>,
                <span class="name">pieceDrawSize</span>
            )
        end
    end
end
</pre></div>
<img src="3.png">
<h3>Drawing numbers</h3>
<p>The piece numbers are drawn on top of the pieces.</p>
<p>The piece number is calculated by adding the X position (i.e. column number) to the Y position minus one (i.e. one less than the row number) multiplied by the number of pieces in a row.</p>
<p>For example, on the first row, nothing is added to the X position, so the first number on the first row is 1. On the second row, 4 is added to the X position, so the first number on the second row is 5.</p>
<div class="pre"><pre class="code">
function <span class="name">love.draw</span>()
    for <span class="name">y</span> = <span class="literal">1</span>, <span class="literal">4</span> do
        for <span class="name">x</span> = <span class="literal">1</span>, <span class="literal">4</span> do
            local <span class="name">pieceSize</span> = <span class="literal">100</span>
            local <span class="name">pieceDrawSize</span> = <span class="name">pieceSize</span> - <span class="literal">1</span>
            <span class="call">love.graphics.setColor</span>(<span class="literal">.4</span>, <span class="literal">.1</span>, <span class="literal">.6</span>)
            <span class="call">love.graphics.rectangle</span>(
                <span class="literal">'fill'</span>,
                (<span class="name">x</span> - <span class="literal">1</span>) * <span class="name">pieceSize</span>,
                (<span class="name">y</span> - <span class="literal">1</span>) * <span class="name">pieceSize</span>,
                <span class="name">pieceDrawSize</span>,
                <span class="name">pieceDrawSize</span>
            )
            <span class="highlight"><span class="call">love.graphics.setColor</span>(<span class="literal">1</span>, <span class="literal">1</span>, <span class="literal">1</span>)</span>
            <span class="highlight"><span class="call">love.graphics.print</span>(</span>
            <span class="highlight">    <span class="name">x</span> + ((<span class="name">y</span> - <span class="literal">1</span>) * <span class="literal">4</span>),</span>
            <span class="highlight">    (<span class="name">x</span> - <span class="literal">1</span>) * <span class="name">pieceSize</span>,</span>
            <span class="highlight">    (<span class="name">y</span> - <span class="literal">1</span>) * <span class="name">pieceSize</span></span>
            <span class="highlight">)</span>
        end
    end
end
</pre></div>
<img src="4.png">
<h3>Setting the font</h3>
<p>The font is set to size 30.</p>
<div class="pre"><pre class="code">
function <span class="name">love.load</span>()
    <span class="call">love.graphics.setNewFont</span>(<span class="literal">30</span>)
end
</pre></div>
<img src="5.png">
<h3>Creating the grid</h3>
<p>A grid is created with each piece's number stored at its position on the grid, and this number is drawn.</p>
<p>The number of pieces on the X and Y axes are reused from drawing the pieces, so these are made into variables.</p>
<div class="pre"><pre class="code">
function <span class="name">love.load</span>()
    <span class="comment">--etc.</span>

    <span class="name">gridXCount</span> = <span class="literal">4</span>
    <span class="name">gridYCount</span> = <span class="literal">4</span>

    <span class="name">grid</span> = {}
    for <span class="name">y</span> = <span class="literal">1</span>, <span class="name">gridYCount</span> do
        <span class="name">grid</span>[<span class="name">y</span>] = {}
        for <span class="name">x</span> = <span class="literal">1</span>, <span class="name">gridXCount</span> do
            <span class="name">grid</span>[<span class="name">y</span>][<span class="name">x</span>] = <span class="name">x</span> + ((<span class="name">y</span> - <span class="literal">1</span>) * <span class="name">gridXCount</span>)
        end
    end
end

function <span class="name">love.draw</span>()
    for <span class="name">y</span> = <span class="literal">1</span>, <span class="highlight"><span class="name">gridYCount</span></span> do
        for <span class="name">x</span> = <span class="literal">1</span>, <span class="highlight"><span class="name">gridXCount</span></span> do
            <span class="comment">-- etc.</span>

            <span class="call">love.graphics.print</span>(
                <span class="highlight"><span class="name">grid</span>[<span class="name">y</span>][<span class="name">x</span>]</span>,
                (<span class="name">x</span> - <span class="literal">1</span>) * <span class="name">pieceSize</span>,
                (<span class="name">y</span> - <span class="literal">1</span>) * <span class="name">pieceSize</span>
            )
        end
    end
end
</pre></div>
<h3>Not drawing the empty space</h3>
<p>The number of pieces on each axis multiplied together gives the total number of pieces (in this case 4 times 4 is 16), and a piece is drawn only if it isn't this number.</p>
<div class="pre"><pre class="code">
function <span class="name">love.draw</span>()
    for <span class="name">y</span> = <span class="literal">1</span>, <span class="name">gridYCount</span> do
        for <span class="name">x</span> = <span class="literal">1</span>, <span class="name">gridXCount</span> do
            <span class="highlight">if <span class="name">grid</span>[<span class="name">y</span>][<span class="name">x</span>] ~= <span class="name">gridXCount</span> * <span class="name">gridYCount</span> then</span>
                local <span class="name">pieceSize</span> = <span class="literal">100</span>
                local <span class="name">pieceDrawSize</span> = <span class="name">pieceSize</span> - <span class="literal">1</span>
                <span class="call">love.graphics.setColor</span>(<span class="literal">.4</span>, <span class="literal">.1</span>, <span class="literal">.6</span>)
                <span class="call">love.graphics.rectangle</span>(
                    <span class="literal">'fill'</span>,
                    (<span class="name">x</span> - <span class="literal">1</span>) * <span class="name">pieceSize</span>,
                    (<span class="name">y</span> - <span class="literal">1</span>) * <span class="name">pieceSize</span>,
                    <span class="name">pieceDrawSize</span>,
                    <span class="name">pieceDrawSize</span>
                )
                <span class="call">love.graphics.setColor</span>(<span class="literal">1</span>, <span class="literal">1</span>, <span class="literal">1</span>)
                <span class="call">love.graphics.print</span>(
                    <span class="name">grid</span>[<span class="name">y</span>][<span class="name">x</span>],
                    (<span class="name">x</span> - <span class="literal">1</span>) * <span class="name">pieceSize</span>,
                    (<span class="name">y</span> - <span class="literal">1</span>) * <span class="name">pieceSize</span>
                )
            <span class="highlight">end</span>
        end
    end
end
</pre></div>
<img src="6.png">
<h3>Finding position of empty space</h3>
<p>The first step in moving a piece is finding the position of the empty space.</p>
<p>When a key is pressed, the grid is looped through, and if a piece is equal to the number of pieces on each axis multiplied together (i.e. it's the empty space), then, for now, its position is printed.</p>
<div class="pre"><pre class="code">
function <span class="name">love.keypressed</span>(<span class="name">key</span>)
    local <span class="name">emptyX</span>
    local <span class="name">emptyY</span>

    for <span class="name">y</span> = <span class="literal">1</span>, <span class="name">gridYCount</span> do
        for <span class="name">x</span> = <span class="literal">1</span>, <span class="name">gridXCount</span> do
            if <span class="name">grid</span>[<span class="name">y</span>][<span class="name">x</span>] == <span class="name">gridXCount</span> * <span class="name">gridYCount</span> then
                <span class="name">emptyX</span> = <span class="name">x</span>
                <span class="name">emptyY</span> = <span class="name">y</span>
            end
        end
    end

    <span class="call">print</span>(<span class="literal">'empty x: '</span>..<span class="name">emptyX</span>..<span class="literal">', empty y: '</span>..<span class="name">emptyY</span>)
end
</pre></div>
<div class="pre"><pre class="console">
empty x: 4, empty y: 4
</pre></div>
<h3>Moving pieces down</h3>
<p>For now, when a is key is pressed, the empty space is swapped with the piece above it (i.e. minus 1 on the Y axis).</p>
<p>Currently this will error when a key is pressed and the empty space is at the top of the grid.</p>
<div class="pre"><pre class="code">
function <span class="name">love.keypressed</span>(<span class="name">key</span>)
    <span class="comment">-- etc.</span>

    <span class="name">grid</span>[<span class="name">emptyY</span> - <span class="literal">1</span>][<span class="name">emptyX</span>], <span class="name">grid</span>[<span class="name">emptyY</span>][<span class="name">emptyX</span>] = 
    <span class="name">grid</span>[<span class="name">emptyY</span>][<span class="name">emptyX</span>], <span class="name">grid</span>[<span class="name">emptyY</span> - <span class="literal">1</span>][<span class="name">emptyX</span>]
end
</pre></div>
<img src="7.png">
<h3>Only move down if possible</h3>
<p>If <span class="inlinecode">
<span class="name">grid</span>[<span class="name">emptyY</span> - <span class="literal">1</span>]</span> is nil (i.e. <span class="inlinecode">
<span class="name">emptyY</span></span> is 1 so <span class="inlinecode">
<span class="name">emptyY</span> - 1</span> is 0), then <span class="inlinecode">
<span class="name">grid</span>[<span class="name">empty</span> - <span class="literal">1</span>][<span class="name">emptyX</span>]</span> will cause an error because the <span class="inlinecode">
[<span class="name">emptyX</span>]</span> part is trying to index nil.</p>
<p>To prevent this, moving is only possible if <span class="inlinecode">
<span class="name">grid</span>[<span class="name">emptyY</span> - <span class="literal">1</span>]</span> is a non-nil value.</p>
<div class="pre"><pre class="code">
function <span class="name">love.keypressed</span>(<span class="name">key</span>)
    <span class="comment">-- etc.</span>

    <span class="highlight">if <span class="name">grid</span>[<span class="name">emptyY</span> - <span class="literal">1</span>] then</span>
        <span class="name">grid</span>[<span class="name">emptyY</span> - <span class="literal">1</span>][<span class="name">emptyX</span>], <span class="name">grid</span>[<span class="name">emptyY</span>][<span class="name">emptyX</span>] =
        <span class="name">grid</span>[<span class="name">emptyY</span>][<span class="name">emptyX</span>], <span class="name">grid</span>[<span class="name">emptyY</span> - <span class="literal">1</span>][<span class="name">emptyX</span>]
    <span class="highlight">end</span>
end
</pre></div>
<h3>Moving pieces up</h3>
<p>The Y position of the piece that the empty space swaps with is made into a variable, and when the up key is pressed, it is set to the position below the empty space (i.e. plus 1 on the Y axis).</p>
<div class="pre"><pre class="code">
function <span class="name">love.keypressed</span>(<span class="name">key</span>)
    <span class="comment">-- etc.</span>
 
    <span class="highlight">local <span class="name">newEmptyY</span></span>
    <span class="highlight">if <span class="name">key</span> == <span class="literal">'down'</span> then</span>
    <span class="highlight">    <span class="name">newEmptyY</span> = <span class="name">emptyY</span> -  <span class="literal">1</span></span>
    <span class="highlight">elseif <span class="name">key</span> == <span class="literal">'up'</span> then</span>
    <span class="highlight">    <span class="name">newEmptyY</span> = <span class="name">emptyY</span> +  <span class="literal">1</span></span>
    <span class="highlight">end</span>

    if <span class="name">grid</span>[<span class="highlight"><span class="name">newEmptyY</span></span>] then
        <span class="name">grid</span>[<span class="highlight"><span class="name">newEmptyY</span></span>][<span class="name">emptyX</span>], <span class="name">grid</span>[<span class="name">emptyY</span>][<span class="name">emptyX</span>] = 
        <span class="name">grid</span>[<span class="name">emptyY</span>][<span class="name">emptyX</span>], <span class="name">grid</span>[<span class="highlight"><span class="name">newEmptyY</span></span>][<span class="name">emptyX</span>]
    end
end
</pre></div>
<h3>Moving pieces left and right</h3>
<p>The X position of the piece that the empty space swaps with is made into a variable, and it is changed when the left or right arrow is pressed.</p>
<p>The X and Y positions of the piece that the empty space swaps with are initially set to the space's position, so that if one of the axes is not changed it uses the empty space's position on that axis.</p>
<p>Currently this will error when the left/right key is pressed and the empty space is already at the rightmost/leftmost position.</p>
<div class="pre"><pre class="code">
function <span class="name">love.keypressed</span>(<span class="name">key</span>)
    <span class="comment">-- etc.</span>
 
    local <span class="name">newEmptyY</span> <span class="highlight">= <span class="name">emptyY</span></span>
    <span class="highlight">local <span class="name">newEmptyX</span> = <span class="name">emptyX</span></span>

    if <span class="name">key</span> == <span class="literal">'down'</span> then
        <span class="name">newEmptyY</span> = <span class="name">emptyY</span> -  <span class="literal">1</span>
    elseif <span class="name">key</span> == <span class="literal">'up'</span> then
        <span class="name">newEmptyY</span> = <span class="name">emptyY</span> +  <span class="literal">1</span>
    <span class="highlight">elseif <span class="name">key</span> == <span class="literal">'right'</span> then</span>
    <span class="highlight">    <span class="name">newEmptyX</span> = <span class="name">emptyX</span> -  <span class="literal">1</span></span>
    <span class="highlight">elseif <span class="name">key</span> == <span class="literal">'left'</span> then</span>
    <span class="highlight">    <span class="name">newEmptyX</span> = <span class="name">emptyX</span> +  <span class="literal">1</span></span>
    end

    if <span class="name">grid</span>[<span class="name">newEmptyY</span>] then
        <span class="name">grid</span>[<span class="name">newEmptyY</span>][<span class="highlight"><span class="name">newEmptyX</span></span>], <span class="name">grid</span>[<span class="name">emptyY</span>][<span class="name">emptyX</span>] = 
        <span class="name">grid</span>[<span class="name">emptyY</span>][<span class="name">emptyX</span>], <span class="name">grid</span>[<span class="name">newEmptyY</span>][<span class="highlight"><span class="name">newEmptyX</span></span>]
    end
end
</pre></div>
<img src="8.png">
<h3>Only move on X axis if possible.</h3>
<p>If <span class="inlinecode">
<span class="name">grid</span>[<span class="name">newEmptyY</span>][<span class="name">newEmptyX</span>]</span> is nil (for example when <span class="inlinecode">
<span class="name">newEmptyX</span></span> is 0), then <span class="inlinecode">
<span class="name">grid</span>[<span class="name">emptyY</span>][<span class="name">emptyX</span>]</span> will be assigned nil, and <span class="inlinecode">
<span class="name">love.graphics.print</span></span> will error when it is given nil instead of a number.</p>
<p>To prevent this, moving is only possible if <span class="inlinecode">
<span class="name">grid</span>[<span class="name">newEmptyY</span>][<span class="name">newEmptyX</span>]</span> is a non-nil value.</p>
<div class="pre"><pre class="code">
function <span class="name">love.keypressed</span>(<span class="name">key</span>)
    <span class="comment">-- etc.</span>

    if <span class="name">grid</span>[<span class="name">newEmptyY</span>] <span class="highlight">and <span class="name">grid</span>[<span class="name">newEmptyY</span>][<span class="name">newEmptyX</span>]</span> then
        <span class="name">grid</span>[<span class="name">newEmptyY</span>][<span class="name">newEmptyX</span>], <span class="name">grid</span>[<span class="name">emptyY</span>][<span class="name">emptyX</span>] = 
        <span class="name">grid</span>[<span class="name">emptyY</span>][<span class="name">emptyX</span>], <span class="name">grid</span>[<span class="name">newEmptyY</span>][<span class="name">newEmptyX</span>]
    end
end
</pre></div>
<h3>Shuffling</h3>
<p>At the beginning of the game, a number of random moves are made to shuffle the board.</p>
<p>A random number between 1 and 4 is generated and a move is made in one of the four movement directions based on this number.</p>
<div class="pre"><pre class="code">
function <span class="name">love.load</span>()
    <span class="comment">-- etc.</span>

    <span class="highlight">for <span class="name">moveNumber</span> = <span class="literal">1</span>, <span class="literal">1000</span> do</span>
        local <span class="name">emptyX</span>
        local <span class="name">emptyY</span>

        for <span class="name">y</span> = <span class="literal">1</span>, <span class="name">gridYCount</span> do
            for <span class="name">x</span> = <span class="literal">1</span>, <span class="name">gridXCount</span> do
                if <span class="name">grid</span>[<span class="name">y</span>][<span class="name">x</span>] == <span class="name">gridXCount</span> * <span class="name">gridYCount</span> then
                    <span class="name">emptyX</span> = <span class="name">x</span>
                    <span class="name">emptyY</span> = <span class="name">y</span>
                end
            end
        end

        local <span class="name">newEmptyY</span> = <span class="name">emptyY</span>
        local <span class="name">newEmptyX</span> = <span class="name">emptyX</span>

        <span class="highlight">local <span class="name">roll</span> = <span class="call">love.math.random</span>(<span class="literal">4</span>)</span>
        if <span class="highlight"><span class="name">roll</span> == <span class="literal">1</span></span> then
            <span class="name">newEmptyY</span> = <span class="name">emptyY</span> - <span class="literal">1</span>
        elseif <span class="highlight"><span class="name">roll</span> == <span class="literal">2</span></span> then
            <span class="name">newEmptyY</span> = <span class="name">emptyY</span> + <span class="literal">1</span>
        elseif <span class="highlight"><span class="name">roll</span> == <span class="literal">3</span></span> then
            <span class="name">newEmptyX</span> = <span class="name">emptyX</span> - <span class="literal">1</span>
        elseif <span class="highlight"><span class="name">roll</span> == <span class="literal">4</span></span> then
            <span class="name">newEmptyX</span> = <span class="name">emptyX</span> + <span class="literal">1</span>
        end

        if <span class="name">grid</span>[<span class="name">newEmptyY</span>] and <span class="name">grid</span>[<span class="name">newEmptyY</span>][<span class="name">newEmptyX</span>] then
            <span class="name">grid</span>[<span class="name">newEmptyY</span>][<span class="name">newEmptyX</span>], <span class="name">grid</span>[<span class="name">emptyY</span>][<span class="name">emptyX</span>] = 
            <span class="name">grid</span>[<span class="name">emptyY</span>][<span class="name">emptyX</span>], <span class="name">grid</span>[<span class="name">newEmptyY</span>][<span class="name">newEmptyX</span>]
        end
    <span class="highlight">end</span>
end
</pre></div>
<img src="9.png">
<h3>Simplifying code</h3>
<p>The only difference between the shuffling code and the keyboard controlled code is how the direction of the move is determined, so a function is made with the direction as a parameter.</p>
<div class="pre"><pre class="code">
function <span class="name">love.load</span>()
    <span class="comment">-- etc.</span>

    <span class="highlight">function <span class="name">move</span>(<span class="name">direction</span>)</span>
        local <span class="name">emptyX</span>
        local <span class="name">emptyY</span>

        for <span class="name">y</span> = <span class="literal">1</span>, <span class="name">gridYCount</span> do
            for <span class="name">x</span> = <span class="literal">1</span>, <span class="name">gridXCount</span> do
                if <span class="name">grid</span>[<span class="name">y</span>][<span class="name">x</span>] == <span class="name">gridXCount</span> * <span class="name">gridYCount</span> then
                    <span class="name">emptyX</span> = <span class="name">x</span>
                    <span class="name">emptyY</span> = <span class="name">y</span>
                end
            end
        end

        local <span class="name">newEmptyY</span> = <span class="name">emptyY</span>
        local <span class="name">newEmptyX</span> = <span class="name">emptyX</span>

        if <span class="highlight"><span class="name">direction</span> == <span class="literal">'down'</span></span> then
            <span class="name">newEmptyY</span> = <span class="name">emptyY</span> -  <span class="literal">1</span>
        elseif <span class="highlight"><span class="name">direction</span> == <span class="literal">'up'</span></span> then
            <span class="name">newEmptyY</span> = <span class="name">emptyY</span> +  <span class="literal">1</span>
        elseif <span class="highlight"><span class="name">direction</span> == <span class="literal">'right'</span></span> then
            <span class="name">newEmptyX</span> = <span class="name">emptyX</span> -  <span class="literal">1</span>
        elseif <span class="highlight"><span class="name">direction</span> == <span class="literal">'left'</span></span> then
            <span class="name">newEmptyX</span> = <span class="name">emptyX</span> +  <span class="literal">1</span>
        end

        if <span class="name">grid</span>[<span class="name">newEmptyY</span>] and <span class="name">grid</span>[<span class="name">newEmptyY</span>][<span class="name">newEmptyX</span>] then
            <span class="name">grid</span>[<span class="name">newEmptyY</span>][<span class="name">newEmptyX</span>], <span class="name">grid</span>[<span class="name">emptyY</span>][<span class="name">emptyX</span>] = 
            <span class="name">grid</span>[<span class="name">emptyY</span>][<span class="name">emptyX</span>], <span class="name">grid</span>[<span class="name">newEmptyY</span>][<span class="name">newEmptyX</span>]
        end
    end

    for <span class="name">moveNumber</span> = <span class="literal">1</span>, <span class="literal">1000</span> do
        local <span class="name">roll</span> = <span class="call">love.math.random</span>(<span class="literal">4</span>)
        if <span class="name">roll</span> == <span class="literal">1</span> then
            <span class="highlight"><span class="call">move</span>(<span class="literal">'down'</span>)</span>
        elseif <span class="name">roll</span> == <span class="literal">2</span> then
            <span class="highlight"><span class="call">move</span>(<span class="literal">'up'</span>)</span>
        elseif <span class="name">roll</span> == <span class="literal">3</span> then
            <span class="highlight"><span class="call">move</span>(<span class="literal">'right'</span>)</span>
        elseif <span class="name">roll</span> == <span class="literal">4</span> then
            <span class="highlight"><span class="call">move</span>(<span class="literal">'left'</span>)</span>
        end
    end
end

function <span class="name">love.keypressed</span>(<span class="name">key</span>)
    if <span class="name">key</span> == <span class="literal">'down'</span> then
        <span class="highlight"><span class="call">move</span>(<span class="literal">'down'</span>)</span>
    elseif <span class="name">key</span> == <span class="literal">'up'</span> then
        <span class="highlight"><span class="call">move</span>(<span class="literal">'up'</span>)</span>
    elseif <span class="name">key</span> == <span class="literal">'right'</span> then
        <span class="highlight"><span class="call">move</span>(<span class="literal">'right'</span>)</span>
    elseif <span class="name">key</span> == <span class="literal">'left'</span> then
        <span class="highlight"><span class="call">move</span>(<span class="literal">'left'</span>)</span>
    end
end
</pre></div>
<h3>Making the bottom-right position empty</h3>
<p>So that the empty space always starts in the bottom-right corner, the pieces are moved left and up repeatedly. The number of pieces on an axis minus 1 is the maximum number of moves it would take to move the space from one side to the other.</p>
<div class="pre"><pre class="code">
function <span class="name">love.load</span>()
    <span class="comment">-- etc.</span>

    for <span class="name">moveNumber</span> = <span class="literal">1</span>, <span class="name">gridXCount</span> - <span class="literal">1</span> do
        <span class="call">move</span>(<span class="literal">'left'</span>)
    end

    for <span class="name">moveNumber</span> = <span class="literal">1</span>, <span class="name">gridYCount</span> - <span class="literal">1</span> do
        <span class="call">move</span>(<span class="literal">'up'</span>)
    end
end
</pre></div>
<img src="10.png">
<h3>Check if complete</h3>
<p>After a move is made, the pieces are looped through, and if none of the pieces are not equal to the number they were initially given (i.e. they are all in their sorted positions), then the game is complete.</p>
<p>For now, <span class="inlinecode">
<span class="name">love.load</span></span> is called to start a new game.</p>
<div class="pre"><pre class="code">
function <span class="name">love.keypressed</span>(<span class="name">key</span>)
    <span class="comment">-- etc.</span>

    local <span class="name">complete</span> = <span class="literal">true</span>

    for <span class="name">y</span> = <span class="literal">1</span>, <span class="name">gridYCount</span> do
        for <span class="name">x</span> = <span class="literal">1</span>, <span class="name">gridXCount</span> do
            if <span class="name">grid</span>[<span class="name">y</span>][<span class="name">x</span>] ~= ((<span class="name">y</span> - <span class="literal">1</span>) * <span class="name">gridXCount</span>) + <span class="literal">1</span> then
                <span class="name">complete</span> = <span class="literal">false</span>
            end
        end
    end

    if <span class="name">complete</span> then
        <span class="call">love.load</span>()
    end
end
</pre></div>
<h3>Simplifying code</h3>
<p>The code for calculating the initial value of a piece is reused, so it is made into a function.</p>
<div class="pre"><pre class="code">
function <span class="name">love.load</span>()
    <span class="comment">-- etc.</span>

    <span class="highlight">function <span class="name">getInitialValue</span>(<span class="name">x</span>, <span class="name">y</span>)</span>
    <span class="highlight">    return <span class="name">x</span> + ((<span class="name">y</span> - <span class="literal">1</span>) * <span class="name">gridXCount</span>)</span>
    <span class="highlight">end</span>

    <span class="name">grid</span> = {}
    for <span class="name">y</span> = <span class="literal">1</span>, <span class="name">gridYCount</span> do
        <span class="name">grid</span>[<span class="name">y</span>] = {}
        for <span class="name">x</span> = <span class="literal">1</span>, <span class="name">gridXCount</span> do
            <span class="name">grid</span>[<span class="name">y</span>][<span class="name">x</span>] = <span class="highlight"><span class="call">getInitialValue</span>(<span class="name">x</span>, <span class="name">y</span>)</span>
        end
    end

    <span class="comment">-- etc.</span>

function <span class="name">love.keypressed</span>(<span class="name">key</span>)
    <span class="comment">-- etc.</span>

    for <span class="name">y</span> = <span class="literal">1</span>, <span class="name">gridYCount</span> do
        for <span class="name">x</span> = <span class="literal">1</span>, <span class="name">gridXCount</span> do
            if <span class="name">grid</span>[<span class="name">y</span>][<span class="name">x</span>] ~= <span class="highlight"><span class="call">getInitialValue</span>(<span class="name">x</span>, <span class="name">y</span>)</span> then
                <span class="name">complete</span> = <span class="literal">false</span>
            end
        end
    end

    <span class="comment">-- etc.</span>
end
</pre></div>
<h3>Reshuffle if complete after shuffling</h3>
<p>If the pieces are still in their initial order after shuffling, the shuffling process happens again.</p>
<p>The code for checking if the pieces are in their initial order is reused, so it is made into a function.</p>
<div class="pre"><pre class="code">
function <span class="name">love.load</span>()
    <span class="comment">-- etc.</span>

    <span class="highlight">function <span class="name">isComplete</span>()</span>
        for <span class="name">y</span> = <span class="literal">1</span>, <span class="name">gridYCount</span> do
            for <span class="name">x</span> = <span class="literal">1</span>, <span class="name">gridXCount</span> do
                if <span class="name">grid</span>[<span class="name">y</span>][<span class="name">x</span>] ~= <span class="call">getInitialValue</span>(<span class="name">x</span>, <span class="name">y</span>) then
                    <span class="highlight">return <span class="literal">false</span></span>
                end
            end
        end
        <span class="highlight">return <span class="literal">true</span></span>
    <span class="highlight">end</span>

    <span class="highlight">repeat</span>
        for <span class="name">moveNumber</span> = <span class="literal">1</span>, <span class="literal">1000</span> do
            local <span class="name">roll</span> = <span class="call">love.math.random</span>(<span class="literal">4</span>)
            if <span class="name">roll</span> == <span class="literal">1</span> then
                <span class="call">move</span>(<span class="literal">'down'</span>)
            elseif <span class="name">roll</span> == <span class="literal">2</span> then
                <span class="call">move</span>(<span class="literal">'up'</span>)
            elseif <span class="name">roll</span> == <span class="literal">3</span> then
                <span class="call">move</span>(<span class="literal">'right'</span>)
            elseif <span class="name">roll</span> == <span class="literal">4</span> then
                <span class="call">move</span>(<span class="literal">'left'</span>)
            end
        end

        for <span class="name">moveNumber</span> = <span class="literal">1</span>, <span class="name">gridXCount</span> - <span class="literal">1</span> do
            <span class="call">move</span>(<span class="literal">'left'</span>)
        end

        for <span class="name">moveNumber</span> = <span class="literal">1</span>, <span class="name">gridYCount</span> - <span class="literal">1</span> do
            <span class="call">move</span>(<span class="literal">'up'</span>)
        end
    <span class="highlight">until not <span class="call">isComplete</span>()</span>
end

function <span class="name">love.keypressed</span>(<span class="name">key</span>)
    if <span class="name">key</span> == <span class="literal">'down'</span> then
        <span class="call">move</span>(<span class="literal">'down'</span>)
    elseif <span class="name">key</span> == <span class="literal">'up'</span> then
        <span class="call">move</span>(<span class="literal">'up'</span>)
    elseif <span class="name">key</span> == <span class="literal">'right'</span> then
        <span class="call">move</span>(<span class="literal">'right'</span>)
    elseif <span class="name">key</span> == <span class="literal">'left'</span> then
        <span class="call">move</span>(<span class="literal">'left'</span>)
    end

    if <span class="highlight"><span class="call">isComplete</span>()</span> then
        <span class="call">love.load</span>()
    end
end
</pre></div>
<h3>Resetting</h3>
<p>When the game is over only some variables need to be reset, so a function is made.</p>
<div class="pre"><pre class="code">
function <span class="name">love.load</span>()
    <span class="call">love.graphics.setNewFont</span>(<span class="literal">30</span>)
    
    <span class="name">gridXCount</span> = <span class="literal">4</span>
    <span class="name">gridYCount</span> = <span class="literal">4</span>

    function <span class="name">getInitialValue</span>(<span class="name">x</span>, <span class="name">y</span>)
        <span class="comment">-- etc.</span>
    end
    
    function <span class="name">move</span>(<span class="name">direction</span>)
        <span class="comment">-- etc.</span>
    end

    function <span class="name">isComplete</span>()
        <span class="comment">-- etc.</span>
    end

    <span class="highlight">function <span class="name">reset</span>()</span>
        <span class="name">grid</span> = {}
        for <span class="name">y</span> = <span class="literal">1</span>, <span class="name">gridYCount</span> do
            <span class="name">grid</span>[<span class="name">y</span>] = {}
            for <span class="name">x</span> = <span class="literal">1</span>, <span class="name">gridXCount</span> do
                <span class="name">grid</span>[<span class="name">y</span>][<span class="name">x</span>] = <span class="call">getInitialValue</span>(<span class="name">x</span>, <span class="name">y</span>)
            end
        end

        repeat
            for <span class="name">moveNumber</span> = <span class="literal">1</span>, <span class="literal">1000</span> do
                local <span class="name">roll</span> = <span class="call">love.math.random</span>(<span class="literal">4</span>)
                if <span class="name">roll</span> == <span class="literal">1</span> then
                    <span class="call">move</span>(<span class="literal">'down'</span>)
                elseif <span class="name">roll</span> == <span class="literal">2</span> then
                    <span class="call">move</span>(<span class="literal">'up'</span>)
                elseif <span class="name">roll</span> == <span class="literal">3</span> then
                    <span class="call">move</span>(<span class="literal">'right'</span>)
                elseif <span class="name">roll</span> == <span class="literal">4</span> then
                    <span class="call">move</span>(<span class="literal">'left'</span>)
                end
            end

            for <span class="name">moveNumber</span> = <span class="literal">1</span>, <span class="name">gridXCount</span> - <span class="literal">1</span> do
                <span class="call">move</span>(<span class="literal">'left'</span>)
            end

            for <span class="name">moveNumber</span> = <span class="literal">1</span>, <span class="name">gridYCount</span> - <span class="literal">1</span> do
                <span class="call">move</span>(<span class="literal">'up'</span>)
            end
        until not <span class="call">isComplete</span>()
    <span class="highlight">end</span>

    <span class="highlight"><span class="call">reset</span>()</span>
end

function <span class="name">love.keypressed</span>(<span class="name">key</span>)
    <span class="comment">-- etc.</span>
    
    if <span class="call">isComplete</span>() then
        <span class="highlight"><span class="call">reset</span>()</span>
    end
end
</pre></div>
<h2>Final code</h2>
<div class="pre"><pre class="code">
function <span class="name">love.load</span>()
    <span class="call">love.graphics.setNewFont</span>(<span class="literal">30</span>)
    
    <span class="name">gridXCount</span> = <span class="literal">4</span>
    <span class="name">gridYCount</span> = <span class="literal">4</span>

    function <span class="name">getInitialValue</span>(<span class="name">x</span>, <span class="name">y</span>)
        return <span class="name">x</span> + ((<span class="name">y</span> - <span class="literal">1</span>) * <span class="name">gridXCount</span>)
    end
    
    function <span class="name">move</span>(<span class="name">direction</span>)
        local <span class="name">emptyX</span>
        local <span class="name">emptyY</span>

        for <span class="name">y</span> = <span class="literal">1</span>, <span class="name">gridYCount</span> do
            for <span class="name">x</span> = <span class="literal">1</span>, <span class="name">gridXCount</span> do
                if <span class="name">grid</span>[<span class="name">y</span>][<span class="name">x</span>] == <span class="name">gridXCount</span> * <span class="name">gridYCount</span> then
                    <span class="name">emptyX</span> = <span class="name">x</span>
                    <span class="name">emptyY</span> = <span class="name">y</span>
                end
            end
        end

        local <span class="name">newEmptyY</span> = <span class="name">emptyY</span>
        local <span class="name">newEmptyX</span> = <span class="name">emptyX</span>

        if <span class="name">direction</span> == <span class="literal">'down'</span> then
            <span class="name">newEmptyY</span> = <span class="name">emptyY</span> -  <span class="literal">1</span>
        elseif <span class="name">direction</span> == <span class="literal">'up'</span> then
            <span class="name">newEmptyY</span> = <span class="name">emptyY</span> +  <span class="literal">1</span>
        elseif <span class="name">direction</span> == <span class="literal">'right'</span> then
            <span class="name">newEmptyX</span> = <span class="name">emptyX</span> -  <span class="literal">1</span>
        elseif <span class="name">direction</span> == <span class="literal">'left'</span> then
            <span class="name">newEmptyX</span> = <span class="name">emptyX</span> +  <span class="literal">1</span>
        end

        if <span class="name">grid</span>[<span class="name">newEmptyY</span>] and <span class="name">grid</span>[<span class="name">newEmptyY</span>][<span class="name">newEmptyX</span>] then
            <span class="name">grid</span>[<span class="name">newEmptyY</span>][<span class="name">newEmptyX</span>], <span class="name">grid</span>[<span class="name">emptyY</span>][<span class="name">emptyX</span>] = 
            <span class="name">grid</span>[<span class="name">emptyY</span>][<span class="name">emptyX</span>], <span class="name">grid</span>[<span class="name">newEmptyY</span>][<span class="name">newEmptyX</span>]
        end
    end

    function <span class="name">isComplete</span>()
        for <span class="name">y</span> = <span class="literal">1</span>, <span class="name">gridYCount</span> do
            for <span class="name">x</span> = <span class="literal">1</span>, <span class="name">gridXCount</span> do
                if <span class="name">grid</span>[<span class="name">y</span>][<span class="name">x</span>] ~= <span class="call">getInitialValue</span>(<span class="name">x</span>, <span class="name">y</span>) then
                    return <span class="literal">false</span>
                end
            end
        end
        return <span class="literal">true</span>
    end

    function <span class="name">reset</span>()
        <span class="name">grid</span> = {}
        for <span class="name">y</span> = <span class="literal">1</span>, <span class="name">gridYCount</span> do
            <span class="name">grid</span>[<span class="name">y</span>] = {}
            for <span class="name">x</span> = <span class="literal">1</span>, <span class="name">gridXCount</span> do
                <span class="name">grid</span>[<span class="name">y</span>][<span class="name">x</span>] = <span class="call">getInitialValue</span>(<span class="name">x</span>, <span class="name">y</span>)
            end
        end

        repeat
            for <span class="name">moveNumber</span> = <span class="literal">1</span>, <span class="literal">1000</span> do
                local <span class="name">roll</span> = <span class="call">love.math.random</span>(<span class="literal">4</span>)
                if <span class="name">roll</span> == <span class="literal">1</span> then
                    <span class="call">move</span>(<span class="literal">'down'</span>)
                elseif <span class="name">roll</span> == <span class="literal">2</span> then
                    <span class="call">move</span>(<span class="literal">'up'</span>)
                elseif <span class="name">roll</span> == <span class="literal">3</span> then
                    <span class="call">move</span>(<span class="literal">'right'</span>)
                elseif <span class="name">roll</span> == <span class="literal">4</span> then
                    <span class="call">move</span>(<span class="literal">'left'</span>)
                end
            end

            for <span class="name">moveNumber</span> = <span class="literal">1</span>, <span class="name">gridXCount</span> - <span class="literal">1</span> do
                <span class="call">move</span>(<span class="literal">'left'</span>)
            end

            for <span class="name">moveNumber</span> = <span class="literal">1</span>, <span class="name">gridYCount</span> - <span class="literal">1</span> do
                <span class="call">move</span>(<span class="literal">'up'</span>)
            end
        until not <span class="call">isComplete</span>()
    end

    <span class="call">reset</span>()
end

function <span class="name">love.draw</span>()
    for <span class="name">y</span> = <span class="literal">1</span>, <span class="name">gridYCount</span> do
        for <span class="name">x</span> = <span class="literal">1</span>, <span class="name">gridXCount</span> do
            if <span class="name">grid</span>[<span class="name">y</span>][<span class="name">x</span>] ~= <span class="name">gridXCount</span> * <span class="name">gridYCount</span> then
                local <span class="name">pieceSize</span> = <span class="literal">100</span>
                local <span class="name">pieceDrawSize</span> = <span class="name">pieceSize</span> - <span class="literal">1</span>
                <span class="call">love.graphics.setColor</span>(<span class="literal">.4</span>, <span class="literal">.1</span>, <span class="literal">.6</span>)
                <span class="call">love.graphics.rectangle</span>(
                    <span class="literal">'fill'</span>,
                    (<span class="name">x</span> - <span class="literal">1</span>) * <span class="name">pieceSize</span>,
                    (<span class="name">y</span> - <span class="literal">1</span>) * <span class="name">pieceSize</span>,
                    <span class="name">pieceDrawSize</span>,
                    <span class="name">pieceDrawSize</span>
                )
                <span class="call">love.graphics.setColor</span>(<span class="literal">1</span>, <span class="literal">1</span>, <span class="literal">1</span>)
                <span class="call">love.graphics.print</span>(
                    <span class="name">grid</span>[<span class="name">y</span>][<span class="name">x</span>],
                    (<span class="name">x</span> - <span class="literal">1</span>) * <span class="name">pieceSize</span>,
                    (<span class="name">y</span> - <span class="literal">1</span>) * <span class="name">pieceSize</span>
                )
            end
        end
    end
end

function <span class="name">love.keypressed</span>(<span class="name">key</span>)
    if <span class="name">key</span> == <span class="literal">'down'</span> then
        <span class="call">move</span>(<span class="literal">'down'</span>)
    elseif <span class="name">key</span> == <span class="literal">'up'</span> then
        <span class="call">move</span>(<span class="literal">'up'</span>)
    elseif <span class="name">key</span> == <span class="literal">'right'</span> then
        <span class="call">move</span>(<span class="literal">'right'</span>)
    elseif <span class="name">key</span> == <span class="literal">'left'</span> then
        <span class="call">move</span>(<span class="literal">'left'</span>)
    end
    
    if <span class="call">isComplete</span>() then
        <span class="call">reset</span>()
    end
end
</pre></div>
</body></html>
